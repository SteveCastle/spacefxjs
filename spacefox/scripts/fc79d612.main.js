function init(){scene=new THREE.Scene,scene.fog=new THREE.FogExp2(15716789,.15),camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,1e4),camera.position.z=1e3,loader=new THREE.JSONLoader,loader.load("/models/arwing.js",function(a){var b=new THREE.Color(0,.8,.7);material=new THREE.MeshBasicMaterial({color:b,wireframe:!0}),mesh=new THREE.Mesh(a,material),scene.add(mesh),mesh.position.z=500,mesh.scale.x=100,mesh.scale.y=100,mesh.scale.z=100,animate()}),createTorus(),renderer=new THREE.CanvasRenderer,renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(renderer.domElement)}function animate(){requestAnimationFrame(animate),mesh.rotation.z=.0015*-mesh.position.x,mesh.rotation.x=.005*mesh.position.y,mesh.position.y+=.855*(+mouseY-mesh.position.y),mesh.position.x+=.855*(+mouseX-mesh.position.x),renderer.render(scene,camera),torus.position.z<1e3?torus.position.z+=50:createTorus()}function onWindowResize(){windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function createTorus(){var a=new THREE.TorusGeometry(200,70,16,40),b=new THREE.Color(Math.random(),0,1),c=new THREE.MeshBasicMaterial({color:b,wireframe:!0});torus=new THREE.Mesh(a,c),torus.position.z=-5e3,scene.add(torus)}function onDocumentMouseMove(a){mouseX=(a.clientX-windowHalfX)/4,mouseY=(a.clientY-windowHalfY)/4}function onDocumentClick(a){console.log("shooting my lazers"),$("div").fadeIn().css({top:a.clientY,left:a.clientX}).delay(100).fadeOut()}function generateHeight(a,b){for(var c=a*b,d=new Uint8Array(c),e=new ImprovedNoise,f=1,g=100*Math.random(),h=0;4>h;h++){for(var i=0;c>i;i++){var j=i%a,k=~~(i/a);d[i]+=Math.abs(e.noise(j/f,k/f,g)*f*1.75)}f*=5}return d}function generateTexture(a,b,c){var d,e,f,g,h,i,j;h=new THREE.Vector3(0,0,0),i=new THREE.Vector3(1,1,1),i.normalize(),d=document.createElement("canvas"),d.width=b,d.height=c,e=d.getContext("2d"),e.fillStyle="#000",e.fillRect(0,0,b,c),f=e.getImageData(0,0,d.width,d.height),g=f.data;for(var k=0,l=0,m=g.length;m>k;k+=4,l++)h.x=a[l-2]-a[l+2],h.y=2,h.z=a[l-2*b]-a[l+2*b],h.normalize(),j=h.dot(i),g[k]=(96+128*j)*(.5+.007*a[l]),g[k+1]=(32+96*j)*(.5+.007*a[l]),g[k+2]=96*j*(.5+.007*a[l])}THREE.JSONLoader=function(a){THREE.Loader.call(this,a),this.withCredentials=!1},THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype),THREE.JSONLoader.prototype.load=function(a,b,c){c=c&&"string"==typeof c?c:this.extractUrlBase(a),this.onLoadStart(),this.loadAjaxJSON(this,a,b,c)},THREE.JSONLoader.prototype.loadAjaxJSON=function(a,b,c,d,e){var f=new XMLHttpRequest,g=0;f.onreadystatechange=function(){if(f.readyState===f.DONE)if(200===f.status||0===f.status){if(f.responseText){var h=JSON.parse(f.responseText);if(void 0!==h.metadata&&"scene"===h.metadata.type)return void console.error('THREE.JSONLoader: "'+b+'" seems to be a Scene. Use THREE.SceneLoader instead.');var i=a.parse(h,d);c(i.geometry,i.materials)}else console.error('THREE.JSONLoader: "'+b+'" seems to be unreachable or the file is empty.');a.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load \""+b+'" ('+f.status+")");else f.readyState===f.LOADING?e&&(0===g&&(g=f.getResponseHeader("Content-Length")),e({total:g,loaded:f.responseText.length})):f.readyState===f.HEADERS_RECEIVED&&void 0!==e&&(g=f.getResponseHeader("Content-Length"))},f.open("GET",b,!0),f.withCredentials=this.withCredentials,f.send(null)},THREE.JSONLoader.prototype.parse=function(a,b){function c(b){function c(a,b){return a&1<<b}var d,e,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F=a.faces,G=a.vertices,H=a.normals,I=a.colors,J=0;if(void 0!==a.uvs){for(d=0;d<a.uvs.length;d++)a.uvs[d].length&&J++;for(d=0;J>d;d++)f.faceVertexUvs[d]=[]}for(h=0,i=G.length;i>h;)v=new THREE.Vector3,v.x=G[h++]*b,v.y=G[h++]*b,v.z=G[h++]*b,f.vertices.push(v);for(h=0,i=F.length;i>h;)if(n=F[h++],o=c(n,0),p=c(n,1),q=c(n,3),r=c(n,4),s=c(n,5),t=c(n,6),u=c(n,7),o){if(x=new THREE.Face3,x.a=F[h],x.b=F[h+1],x.c=F[h+3],y=new THREE.Face3,y.a=F[h+1],y.b=F[h+2],y.c=F[h+3],h+=4,p&&(m=F[h++],x.materialIndex=m,y.materialIndex=m),g=f.faces.length,q)for(d=0;J>d;d++)for(B=a.uvs[d],f.faceVertexUvs[d][g]=[],f.faceVertexUvs[d][g+1]=[],e=0;4>e;e++)l=F[h++],D=B[2*l],E=B[2*l+1],C=new THREE.Vector2(D,E),2!==e&&f.faceVertexUvs[d][g].push(C),0!==e&&f.faceVertexUvs[d][g+1].push(C);if(r&&(k=3*F[h++],x.normal.set(H[k++],H[k++],H[k]),y.normal.copy(x.normal)),s)for(d=0;4>d;d++)k=3*F[h++],A=new THREE.Vector3(H[k++],H[k++],H[k]),2!==d&&x.vertexNormals.push(A),0!==d&&y.vertexNormals.push(A);if(t&&(j=F[h++],z=I[j],x.color.setHex(z),y.color.setHex(z)),u)for(d=0;4>d;d++)j=F[h++],z=I[j],2!==d&&x.vertexColors.push(new THREE.Color(z)),0!==d&&y.vertexColors.push(new THREE.Color(z));f.faces.push(x),f.faces.push(y)}else{if(w=new THREE.Face3,w.a=F[h++],w.b=F[h++],w.c=F[h++],p&&(m=F[h++],w.materialIndex=m),g=f.faces.length,q)for(d=0;J>d;d++)for(B=a.uvs[d],f.faceVertexUvs[d][g]=[],e=0;3>e;e++)l=F[h++],D=B[2*l],E=B[2*l+1],C=new THREE.Vector2(D,E),f.faceVertexUvs[d][g].push(C);if(r&&(k=3*F[h++],w.normal.set(H[k++],H[k++],H[k])),s)for(d=0;3>d;d++)k=3*F[h++],A=new THREE.Vector3(H[k++],H[k++],H[k]),w.vertexNormals.push(A);if(t&&(j=F[h++],w.color.setHex(I[j])),u)for(d=0;3>d;d++)j=F[h++],w.vertexColors.push(new THREE.Color(I[j]));f.faces.push(w)}}function d(){var b=void 0!==a.influencesPerVertex?a.influencesPerVertex:2;if(a.skinWeights)for(var c=0,d=a.skinWeights.length;d>c;c+=b){var e=a.skinWeights[c],g=b>1?a.skinWeights[c+1]:0,h=b>2?a.skinWeights[c+2]:0,i=b>3?a.skinWeights[c+3]:0;f.skinWeights.push(new THREE.Vector4(e,g,h,i))}if(a.skinIndices)for(var c=0,d=a.skinIndices.length;d>c;c+=b){var j=a.skinIndices[c],k=b>1?a.skinIndices[c+1]:0,l=b>2?a.skinIndices[c+2]:0,m=b>3?a.skinIndices[c+3]:0;f.skinIndices.push(new THREE.Vector4(j,k,l,m))}f.bones=a.bones,f.bones&&f.bones.length>0&&(f.skinWeights.length!==f.skinIndices.length||f.skinIndices.length!==f.vertices.length)&&console.warn("When skinning, number of vertices ("+f.vertices.length+"), skinIndices ("+f.skinIndices.length+"), and skinWeights ("+f.skinWeights.length+") should match."),f.animation=a.animation,f.animations=a.animations}function e(b){if(void 0!==a.morphTargets){var c,d,e,g,h,i;for(c=0,d=a.morphTargets.length;d>c;c++)for(f.morphTargets[c]={},f.morphTargets[c].name=a.morphTargets[c].name,f.morphTargets[c].vertices=[],h=f.morphTargets[c].vertices,i=a.morphTargets[c].vertices,e=0,g=i.length;g>e;e+=3){var j=new THREE.Vector3;j.x=i[e]*b,j.y=i[e+1]*b,j.z=i[e+2]*b,h.push(j)}}if(void 0!==a.morphColors){var c,d,k,l,m,n,o;for(c=0,d=a.morphColors.length;d>c;c++)for(f.morphColors[c]={},f.morphColors[c].name=a.morphColors[c].name,f.morphColors[c].colors=[],m=f.morphColors[c].colors,n=a.morphColors[c].colors,k=0,l=n.length;l>k;k+=3)o=new THREE.Color(16755200),o.setRGB(n[k],n[k+1],n[k+2]),m.push(o)}}var f=new THREE.Geometry,g=void 0!==a.scale?1/a.scale:1;if(c(g),d(),e(g),f.computeFaceNormals(),f.computeBoundingSphere(),void 0===a.materials||0===a.materials.length)return{geometry:f};var h=this.initMaterials(a.materials,b);return this.needsTangents(h)&&f.computeTangents(),{geometry:f,materials:h}},THREE.SpriteCanvasMaterial=function(a){THREE.Material.call(this),this.type="SpriteCanvasMaterial",this.color=new THREE.Color(16777215),this.program=function(a,b){},this.setValues(a)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial,THREE.SpriteCanvasMaterial.prototype.clone=function(){var a=new THREE.SpriteCanvasMaterial;return THREE.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.program=this.program,a},THREE.CanvasRenderer=function(a){function b(){ta.setRGB(0,0,0),ua.setRGB(0,0,0),va.setRGB(0,0,0);for(var a=0,b=y.length;b>a;a++){var c=y[a],d=c.color;c instanceof THREE.AmbientLight?ta.add(d):c instanceof THREE.DirectionalLight?ua.add(d):c instanceof THREE.PointLight&&va.add(d)}}function c(a,b,c){for(var d=0,e=y.length;e>d;d++){var f=y[d];if(oa.copy(f.color),f instanceof THREE.DirectionalLight){var g=wa.setFromMatrixPosition(f.matrixWorld).normalize(),h=b.dot(g);if(0>=h)continue;h*=f.intensity,c.add(oa.multiplyScalar(h))}else if(f instanceof THREE.PointLight){var g=wa.setFromMatrixPosition(f.matrixWorld),h=b.dot(wa.subVectors(g,a).normalize());if(0>=h)continue;if(h*=0==f.distance?1:1-Math.min(a.distanceTo(g)/f.distance,1),0==h)continue;h*=f.intensity,c.add(oa.multiplyScalar(h))}}}function d(a,b,c){n(c.opacity),o(c.blending);var d=b.scale.x*V,e=b.scale.y*W,f=.5*Math.sqrt(d*d+e*e);if(sa.min.set(a.x-f,a.y-f),sa.max.set(a.x+f,a.y+f),c instanceof THREE.SpriteMaterial){var g=c.map;if(null!==g&&void 0!==g.image){g.hasEventListener("update",j)===!1&&(g.image.width>0&&k(g),g.addEventListener("update",j));var h=pa[g.id];t(void 0!==h?h:"rgba( 0, 0, 0, 1 )");var i=g.image,l=i.width*g.offset.x,m=i.height*g.offset.y,p=i.width*g.repeat.x,q=i.height*g.repeat.y,r=d/p,u=e/q;aa.save(),aa.translate(a.x,a.y),0!==c.rotation&&aa.rotate(c.rotation),aa.translate(-d/2,-e/2),aa.scale(r,u),aa.translate(-l,-m),aa.fillRect(l,m,p,q),aa.restore()}else t(c.color.getStyle()),aa.save(),aa.translate(a.x,a.y),0!==c.rotation&&aa.rotate(c.rotation),aa.scale(d,-e),aa.fillRect(-.5,-.5,1,1),aa.restore()}else c instanceof THREE.SpriteCanvasMaterial&&(s(c.color.getStyle()),t(c.color.getStyle()),aa.save(),aa.translate(a.x,a.y),0!==c.rotation&&aa.rotate(c.rotation),aa.scale(d,e),c.program(aa),aa.restore())}function e(a,b,c,d){if(n(d.opacity),o(d.blending),aa.beginPath(),aa.moveTo(a.positionScreen.x,a.positionScreen.y),aa.lineTo(b.positionScreen.x,b.positionScreen.y),d instanceof THREE.LineBasicMaterial){if(p(d.linewidth),q(d.linecap),r(d.linejoin),d.vertexColors!==THREE.VertexColors)s(d.color.getStyle());else{var e=c.vertexColors[0].getStyle(),f=c.vertexColors[1].getStyle();if(e===f)s(e);else{try{var g=aa.createLinearGradient(a.positionScreen.x,a.positionScreen.y,b.positionScreen.x,b.positionScreen.y);g.addColorStop(0,e),g.addColorStop(1,f)}catch(h){g=e}s(g)}}aa.stroke(),sa.expandByScalar(2*d.linewidth)}else d instanceof THREE.LineDashedMaterial&&(p(d.linewidth),q(d.linecap),r(d.linejoin),s(d.color.getStyle()),u([d.dashSize,d.gapSize]),aa.stroke(),sa.expandByScalar(2*d.linewidth),u([]))}function f(a,b,d,e,f,j,k,m){if(Q.info.render.vertices+=3,Q.info.render.faces++,n(m.opacity),o(m.blending),D=a.positionScreen.x,E=a.positionScreen.y,F=b.positionScreen.x,G=b.positionScreen.y,H=d.positionScreen.x,I=d.positionScreen.y,g(D,E,F,G,H,I),(m instanceof THREE.MeshLambertMaterial||m instanceof THREE.MeshPhongMaterial)&&null===m.map)ma.copy(m.color),na.copy(m.emissive),m.vertexColors===THREE.FaceColors&&ma.multiply(k.color),la.copy(ta),xa.copy(a.positionWorld).add(b.positionWorld).add(d.positionWorld).divideScalar(3),c(xa,k.normalModel,la),la.multiply(ma).add(na),m.wireframe===!0?h(la,m.wireframeLinewidth,m.wireframeLinecap,m.wireframeLinejoin):i(la);else if(m instanceof THREE.MeshBasicMaterial||m instanceof THREE.MeshLambertMaterial||m instanceof THREE.MeshPhongMaterial)if(null!==m.map){var p=m.map.mapping;p===THREE.UVMapping&&(J=k.uvs,l(D,E,F,G,H,I,J[e].x,J[e].y,J[f].x,J[f].y,J[j].x,J[j].y,m.map))}else null!==m.envMap?m.envMap.mapping===THREE.SphericalReflectionMapping&&(ya.copy(k.vertexNormalsModel[e]).applyMatrix3(za),K=.5*ya.x+.5,L=.5*ya.y+.5,ya.copy(k.vertexNormalsModel[f]).applyMatrix3(za),M=.5*ya.x+.5,N=.5*ya.y+.5,ya.copy(k.vertexNormalsModel[j]).applyMatrix3(za),O=.5*ya.x+.5,P=.5*ya.y+.5,l(D,E,F,G,H,I,K,L,M,N,O,P,m.envMap)):(la.copy(m.color),m.vertexColors===THREE.FaceColors&&la.multiply(k.color),m.wireframe===!0?h(la,m.wireframeLinewidth,m.wireframeLinecap,m.wireframeLinejoin):i(la));else m instanceof THREE.MeshDepthMaterial?(la.r=la.g=la.b=1-v(a.positionScreen.z*a.positionScreen.w,z.near,z.far),m.wireframe===!0?h(la,m.wireframeLinewidth,m.wireframeLinecap,m.wireframeLinejoin):i(la)):m instanceof THREE.MeshNormalMaterial?(ya.copy(k.normalModel).applyMatrix3(za),la.setRGB(ya.x,ya.y,ya.z).multiplyScalar(.5).addScalar(.5),m.wireframe===!0?h(la,m.wireframeLinewidth,m.wireframeLinecap,m.wireframeLinejoin):i(la)):(la.setRGB(1,1,1),m.wireframe===!0?h(la,m.wireframeLinewidth,m.wireframeLinecap,m.wireframeLinejoin):i(la))}function g(a,b,c,d,e,f){aa.beginPath(),aa.moveTo(a,b),aa.lineTo(c,d),aa.lineTo(e,f),aa.closePath()}function h(a,b,c,d){p(b),q(c),r(d),s(a.getStyle()),aa.stroke(),sa.expandByScalar(2*b)}function i(a){t(a.getStyle()),aa.fill()}function j(a){k(a.target)}function k(a){if(!(a instanceof THREE.CompressedTexture)){var b=a.wrapS===THREE.RepeatWrapping,c=a.wrapT===THREE.RepeatWrapping,d=a.image,e=document.createElement("canvas");e.width=d.width,e.height=d.height;var f=e.getContext("2d");f.setTransform(1,0,0,-1,0,d.height),f.drawImage(d,0,0),pa[a.id]=aa.createPattern(e,b===!0&&c===!0?"repeat":b===!0&&c===!1?"repeat-x":b===!1&&c===!0?"repeat-y":"no-repeat")}}function l(a,b,c,d,e,f,g,h,i,l,m,n,o){if(!(o instanceof THREE.DataTexture)){o.hasEventListener("update",j)===!1&&(void 0!==o.image&&o.image.width>0&&k(o),o.addEventListener("update",j));var p=pa[o.id];if(void 0===p)return t("rgba(0,0,0,1)"),void aa.fill();t(p);var q,r,s,u,v,w,x,y,z=o.offset.x/o.repeat.x,A=o.offset.y/o.repeat.y,B=o.image.width*o.repeat.x,C=o.image.height*o.repeat.y;g=(g+z)*B,h=(h+A)*C,i=(i+z)*B,l=(l+A)*C,m=(m+z)*B,n=(n+A)*C,c-=a,d-=b,e-=a,f-=b,i-=g,l-=h,m-=g,n-=h,x=i*n-m*l,0!==x&&(y=1/x,q=(n*c-l*e)*y,r=(n*d-l*f)*y,s=(i*e-m*c)*y,u=(i*f-m*d)*y,v=a-q*g-s*h,w=b-r*g-u*h,aa.save(),aa.transform(q,r,s,u,v,w),aa.fill(),aa.restore())}}function m(a,b,c){var d,e=b.x-a.x,f=b.y-a.y,g=e*e+f*f;0!==g&&(d=c/Math.sqrt(g),e*=d,f*=d,b.x+=e,b.y+=f,a.x-=e,a.y-=f)}function n(a){da!==a&&(aa.globalAlpha=a,da=a)}function o(a){ea!==a&&(a===THREE.NormalBlending?aa.globalCompositeOperation="source-over":a===THREE.AdditiveBlending?aa.globalCompositeOperation="lighter":a===THREE.SubtractiveBlending&&(aa.globalCompositeOperation="darker"),ea=a)}function p(a){ha!==a&&(aa.lineWidth=a,ha=a)}function q(a){ia!==a&&(aa.lineCap=a,ia=a)}function r(a){ja!==a&&(aa.lineJoin=a,ja=a)}function s(a){fa!==a&&(aa.strokeStyle=a,fa=a)}function t(a){ga!==a&&(aa.fillStyle=a,ga=a)}function u(a){ka.length!==a.length&&(aa.setLineDash(a),ka=a)}console.log("THREE.CanvasRenderer",THREE.REVISION);var v=THREE.Math.smoothstep;a=a||{};var w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q=this,R=new THREE.Projector,S=void 0!==a.canvas?a.canvas:document.createElement("canvas"),T=S.width,U=S.height,V=Math.floor(T/2),W=Math.floor(U/2),X=0,Y=0,Z=T,$=U,_=1,aa=S.getContext("2d",{alpha:a.alpha===!0}),ba=new THREE.Color(0),ca=a.alpha===!0?0:1,da=1,ea=0,fa=null,ga=null,ha=null,ia=null,ja=null,ka=[],la=(new THREE.RenderableVertex,new THREE.RenderableVertex,new THREE.Color),ma=(new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color),na=new THREE.Color,oa=new THREE.Color,pa={},qa=new THREE.Box2,ra=new THREE.Box2,sa=new THREE.Box2,ta=new THREE.Color,ua=new THREE.Color,va=new THREE.Color,wa=new THREE.Vector3,xa=new THREE.Vector3,ya=new THREE.Vector3,za=new THREE.Matrix3;void 0===aa.setLineDash&&(aa.setLineDash=function(){}),this.domElement=S,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.getPixelRatio=function(){return _},this.setPixelRatio=function(a){_=a},this.setSize=function(a,b,c){T=a*_,U=b*_,S.width=T,S.height=U,V=Math.floor(T/2),W=Math.floor(U/2),c!==!1&&(S.style.width=a+"px",S.style.height=b+"px"),qa.min.set(-V,-W),qa.max.set(V,W),ra.min.set(-V,-W),ra.max.set(V,W),da=1,ea=0,fa=null,ga=null,ha=null,ia=null,ja=null,this.setViewport(0,0,a,b)},this.setViewport=function(a,b,c,d){X=a*_,Y=b*_,Z=c*_,$=d*_},this.setScissor=function(){},this.enableScissorTest=function(){},this.setClearColor=function(a,b){ba.set(a),ca=void 0!==b?b:1,ra.min.set(-V,-W),ra.max.set(V,W)},this.setClearColorHex=function(a,b){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(a,b)},this.getClearColor=function(){return ba},this.getClearAlpha=function(){return ca},this.getMaxAnisotropy=function(){return 0},this.clear=function(){ra.empty()===!1&&(ra.intersect(qa),ra.expandByScalar(2),ra.min.x=ra.min.x+V,ra.min.y=-ra.min.y+W,ra.max.x=ra.max.x+V,ra.max.y=-ra.max.y+W,1>ca&&aa.clearRect(0|ra.min.x,0|ra.max.y,ra.max.x-ra.min.x|0,ra.min.y-ra.max.y|0),ca>0&&(o(THREE.NormalBlending),n(1),t("rgba("+Math.floor(255*ba.r)+","+Math.floor(255*ba.g)+","+Math.floor(255*ba.b)+","+ca+")"),aa.fillRect(0|ra.min.x,0|ra.max.y,ra.max.x-ra.min.x|0,ra.min.y-ra.max.y|0)),ra.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(a,c){if(c instanceof THREE.Camera==!1)return void console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");this.autoClear===!0&&this.clear(),Q.info.render.vertices=0,Q.info.render.faces=0,aa.setTransform(Z/T,0,0,-$/U,X,U-Y),aa.translate(V,W),w=R.projectScene(a,c,this.sortObjects,this.sortElements),x=w.elements,y=w.lights,z=c,za.getNormalMatrix(c.matrixWorldInverse),b();for(var g=0,h=x.length;h>g;g++){var i=x[g],j=i.material;if(void 0!==j&&0!==j.opacity){if(sa.makeEmpty(),i instanceof THREE.RenderableSprite)A=i,A.x*=V,A.y*=W,d(A,i,j);else if(i instanceof THREE.RenderableLine)A=i.v1,B=i.v2,A.positionScreen.x*=V,A.positionScreen.y*=W,B.positionScreen.x*=V,B.positionScreen.y*=W,sa.setFromPoints([A.positionScreen,B.positionScreen]),qa.isIntersectionBox(sa)===!0&&e(A,B,i,j);else if(i instanceof THREE.RenderableFace){if(A=i.v1,B=i.v2,C=i.v3,A.positionScreen.z<-1||A.positionScreen.z>1)continue;if(B.positionScreen.z<-1||B.positionScreen.z>1)continue;if(C.positionScreen.z<-1||C.positionScreen.z>1)continue;A.positionScreen.x*=V,A.positionScreen.y*=W,B.positionScreen.x*=V,B.positionScreen.y*=W,C.positionScreen.x*=V,C.positionScreen.y*=W,j.overdraw>0&&(m(A.positionScreen,B.positionScreen,j.overdraw),m(B.positionScreen,C.positionScreen,j.overdraw),m(C.positionScreen,A.positionScreen,j.overdraw)),sa.setFromPoints([A.positionScreen,B.positionScreen,C.positionScreen]),qa.isIntersectionBox(sa)===!0&&f(A,B,C,0,1,2,i,j)}ra.union(sa)}}aa.setTransform(1,0,0,1,0,0)}},THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0},THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld),this.positionScreen.copy(a.positionScreen)},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null},THREE.Projector=function(){function a(){if(i===t){var a=new THREE.RenderableObject;return s.push(a),t++,i++,a}return s[i++]}function b(){if(k===v){var a=new THREE.RenderableVertex;return u.push(a),v++,k++,a}return u[k++]}function c(){if(m===x){var a=new THREE.RenderableFace;return w.push(a),x++,m++,a}return w[m++]}function d(){if(o===z){var a=new THREE.RenderableLine;return y.push(a),z++,o++,a}return y[o++]}function e(){if(q===B){var a=new THREE.RenderableSprite;return A.push(a),B++,q++,a}return A[q++]}function f(a,b){return a.z!==b.z?b.z-a.z:a.id!==b.id?a.id-b.id:0}function g(a,b){var c=0,d=1,e=a.z+a.w,f=b.z+b.w,g=-a.z+a.w,h=-b.z+b.w;return e>=0&&f>=0&&g>=0&&h>=0?!0:0>e&&0>f||0>g&&0>h?!1:(0>e?c=Math.max(c,e/(e-f)):0>f&&(d=Math.min(d,e/(e-f))),0>g?c=Math.max(c,g/(g-h)):0>h&&(d=Math.min(d,g/(g-h))),c>d?!1:(a.lerp(b,c),b.lerp(a,1-d),!0))}var h,i,j,k,l,m,n,o,p,q,r,s=[],t=0,u=[],v=0,w=[],x=0,y=[],z=0,A=[],B=0,C={objects:[],lights:[],elements:[]},D=new THREE.Vector3,E=new THREE.Vector4,F=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),G=new THREE.Box3,H=new Array(3),I=(new Array(4),new THREE.Matrix4),J=new THREE.Matrix4,K=new THREE.Matrix4,L=new THREE.Matrix3,M=new THREE.Frustum,N=new THREE.Vector4,O=new THREE.Vector4;this.projectVector=function(a,b){console.warn("THREE.Projector: .projectVector() is now vector.project()."),a.project(b)},this.unprojectVector=function(a,b){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),a.unproject(b)},this.pickingRay=function(a,b){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var P=function(){var a=[],e=[],f=null,g=null,h=new THREE.Matrix3,i=function(b){f=b,g=f.material,h.getNormalMatrix(f.matrixWorld),a.length=0,e.length=0},k=function(a){var b=a.position,c=a.positionWorld,d=a.positionScreen;c.copy(b).applyMatrix4(r),d.copy(c).applyMatrix4(J);var e=1/d.w;d.x*=e,d.y*=e,d.z*=e,a.visible=d.x>=-1&&d.x<=1&&d.y>=-1&&d.y<=1&&d.z>=-1&&d.z<=1},m=function(a,c,d){j=b(),j.position.set(a,c,d),k(j)},o=function(b,c,d){a.push(b,c,d)},p=function(a,b){e.push(a,b)},q=function(a,b,c){return a.visible===!0||b.visible===!0||c.visible===!0?!0:(H[0]=a.positionScreen,H[1]=b.positionScreen,H[2]=c.positionScreen,F.isIntersectionBox(G.setFromPoints(H)))},s=function(a,b,c){return(c.positionScreen.x-a.positionScreen.x)*(b.positionScreen.y-a.positionScreen.y)-(c.positionScreen.y-a.positionScreen.y)*(b.positionScreen.x-a.positionScreen.x)<0},t=function(a,b){var c=u[a],e=u[b];n=d(),n.id=f.id,n.v1.copy(c),n.v2.copy(e),n.z=(c.positionScreen.z+e.positionScreen.z)/2,n.material=f.material,C.elements.push(n)},v=function(b,d,i){var j=u[b],k=u[d],m=u[i];if(q(j,k,m)!==!1&&(g.side===THREE.DoubleSide||s(j,k,m)===!0)){l=c(),l.id=f.id,l.v1.copy(j),l.v2.copy(k),l.v3.copy(m),l.z=(j.positionScreen.z+k.positionScreen.z+m.positionScreen.z)/3;for(var n=0;3>n;n++){var o=3*arguments[n],p=l.vertexNormalsModel[n];p.set(a[o],a[o+1],a[o+2]),p.applyMatrix3(h).normalize();var r=2*arguments[n],t=l.uvs[n];t.set(e[r],e[r+1])}l.vertexNormalsLength=3,l.material=f.material,C.elements.push(l)}};return{setObject:i,projectVertex:k,checkTriangleVisibility:q,checkBackfaceCulling:s,pushVertex:m,pushNormal:o,pushUv:p,pushLine:t,pushTriangle:v}},Q=new P;this.projectScene=function(j,s,t,v){m=0,o=0,q=0,C.elements.length=0,j.autoUpdate===!0&&j.updateMatrixWorld(),void 0===s.parent&&s.updateMatrixWorld(),I.copy(s.matrixWorldInverse.getInverse(s.matrixWorld)),J.multiplyMatrices(s.projectionMatrix,I),M.setFromMatrix(J),i=0,C.objects.length=0,C.lights.length=0,j.traverseVisible(function(b){if(b instanceof THREE.Light)C.lights.push(b);else if(b instanceof THREE.Mesh||b instanceof THREE.Line||b instanceof THREE.Sprite){if(b.material.visible===!1)return;(b.frustumCulled===!1||M.intersectsObject(b)===!0)&&(h=a(),h.id=b.id,h.object=b,D.setFromMatrixPosition(b.matrixWorld),D.applyProjection(J),h.z=D.z,C.objects.push(h))}}),t===!0&&C.objects.sort(f);for(var w=0,x=C.objects.length;x>w;w++){var y=C.objects[w].object,z=y.geometry;if(Q.setObject(y),r=y.matrixWorld,k=0,y instanceof THREE.Mesh){if(z instanceof THREE.BufferGeometry){var A=z.attributes,B=z.offsets;if(void 0===A.position)continue;for(var F=A.position.array,G=0,H=F.length;H>G;G+=3)Q.pushVertex(F[G],F[G+1],F[G+2]);if(void 0!==A.normal)for(var P=A.normal.array,G=0,H=P.length;H>G;G+=3)Q.pushNormal(P[G],P[G+1],P[G+2]);if(void 0!==A.uv)for(var R=A.uv.array,G=0,H=R.length;H>G;G+=2)Q.pushUv(R[G],R[G+1]);if(void 0!==A.index){var S=A.index.array;if(B.length>0)for(var w=0;w<B.length;w++)for(var T=B[w],U=T.index,G=T.start,H=T.start+T.count;H>G;G+=3)Q.pushTriangle(S[G]+U,S[G+1]+U,S[G+2]+U);else for(var G=0,H=S.length;H>G;G+=3)Q.pushTriangle(S[G],S[G+1],S[G+2])}else for(var G=0,H=F.length/3;H>G;G+=3)Q.pushTriangle(G,G+1,G+2)}else if(z instanceof THREE.Geometry){var V=z.vertices,W=z.faces,X=z.faceVertexUvs[0];L.getNormalMatrix(r);for(var Y=y.material,Z=Y instanceof THREE.MeshFaceMaterial,$=Z===!0?y.material:null,_=0,aa=V.length;aa>_;_++){var ba=V[_];if(D.copy(ba),Y.morphTargets===!0)for(var ca=z.morphTargets,da=y.morphTargetInfluences,ea=0,fa=ca.length;fa>ea;ea++){var ga=da[ea];if(0!==ga){var ha=ca[ea],ia=ha.vertices[_];D.x+=(ia.x-ba.x)*ga,D.y+=(ia.y-ba.y)*ga,D.z+=(ia.z-ba.z)*ga}}Q.pushVertex(D.x,D.y,D.z)}for(var ja=0,ka=W.length;ka>ja;ja++){var la=W[ja],Y=Z===!0?$.materials[la.materialIndex]:y.material;if(void 0!==Y){var ma=Y.side,na=u[la.a],oa=u[la.b],pa=u[la.c];if(Q.checkTriangleVisibility(na,oa,pa)!==!1){var qa=Q.checkBackfaceCulling(na,oa,pa);if(ma!==THREE.DoubleSide){if(ma===THREE.FrontSide&&qa===!1)continue;if(ma===THREE.BackSide&&qa===!0)continue}l=c(),l.id=y.id,l.v1.copy(na),l.v2.copy(oa),l.v3.copy(pa),l.normalModel.copy(la.normal),qa!==!1||ma!==THREE.BackSide&&ma!==THREE.DoubleSide||l.normalModel.negate(),l.normalModel.applyMatrix3(L).normalize();for(var ra=la.vertexNormals,sa=0,ta=Math.min(ra.length,3);ta>sa;sa++){var ua=l.vertexNormalsModel[sa];ua.copy(ra[sa]),qa!==!1||ma!==THREE.BackSide&&ma!==THREE.DoubleSide||ua.negate(),ua.applyMatrix3(L).normalize()}l.vertexNormalsLength=ra.length;var va=X[ja];if(void 0!==va)for(var wa=0;3>wa;wa++)l.uvs[wa].copy(va[wa]);l.color=la.color,l.material=Y,l.z=(na.positionScreen.z+oa.positionScreen.z+pa.positionScreen.z)/3,C.elements.push(l)}}}}}else if(y instanceof THREE.Line){if(z instanceof THREE.BufferGeometry){var A=z.attributes;if(void 0!==A.position){for(var F=A.position.array,G=0,H=F.length;H>G;G+=3)Q.pushVertex(F[G],F[G+1],F[G+2]);if(void 0!==A.index)for(var S=A.index.array,G=0,H=S.length;H>G;G+=2)Q.pushLine(S[G],S[G+1]);else for(var xa=y.mode===THREE.LinePieces?2:1,G=0,H=F.length/3-1;H>G;G+=xa)Q.pushLine(G,G+1)}}else if(z instanceof THREE.Geometry){K.multiplyMatrices(J,r);var V=y.geometry.vertices;if(0===V.length)continue;na=b(),na.positionScreen.copy(V[0]).applyMatrix4(K);for(var xa=y.mode===THREE.LinePieces?2:1,_=1,aa=V.length;aa>_;_++)na=b(),na.positionScreen.copy(V[_]).applyMatrix4(K),(_+1)%xa>0||(oa=u[k-2],N.copy(na.positionScreen),O.copy(oa.positionScreen),g(N,O)===!0&&(N.multiplyScalar(1/N.w),O.multiplyScalar(1/O.w),n=d(),n.id=y.id,n.v1.positionScreen.copy(N),n.v2.positionScreen.copy(O),n.z=Math.max(N.z,O.z),n.material=y.material,y.material.vertexColors===THREE.VertexColors&&(n.vertexColors[0].copy(y.geometry.colors[_]),n.vertexColors[1].copy(y.geometry.colors[_-1])),C.elements.push(n)))}}else if(y instanceof THREE.Sprite){E.set(r.elements[12],r.elements[13],r.elements[14],1),E.applyMatrix4(J);var ya=1/E.w;E.z*=ya,E.z>=-1&&E.z<=1&&(p=e(),p.id=y.id,p.x=E.x*ya,p.y=E.y*ya,p.z=E.z,p.object=y,p.rotation=y.rotation,p.scale.x=y.scale.x*Math.abs(p.x-(E.x+s.projectionMatrix.elements[0])/(E.w+s.projectionMatrix.elements[12])),p.scale.y=y.scale.y*Math.abs(p.y-(E.y+s.projectionMatrix.elements[5])/(E.w+s.projectionMatrix.elements[13])),p.material=y.material,C.elements.push(p))}}return v===!0&&C.elements.sort(f),C}};var ImprovedNoise=function(){function a(a){return a*a*a*(a*(6*a-15)+10)}function b(a,b,c){return b+a*(c-b)}function c(a,b,c,d){var e=15&a,f=8>e?b:c,g=4>e?c:12==e||14==e?b:d;return(0==(1&e)?f:-f)+(0==(2&e)?g:-g)}for(var d=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],e=0;256>e;e++)d[256+e]=d[e];return{noise:function(e,f,g){var h=~~e,i=~~f,j=~~g,k=255&h,l=255&i,m=255&j;e-=h,f-=i,g-=j;var n=e-1,o=f-1,p=g-1,q=a(e),r=a(f),s=a(g),t=d[k]+l,u=d[t]+m,v=d[t+1]+m,w=d[k+1]+l,x=d[w]+m,y=d[w+1]+m;return b(s,b(r,b(q,c(d[u],e,f,g),c(d[x],n,f,g)),b(q,c(d[v],e,o,g),c(d[y],n,o,g))),b(r,b(q,c(d[u+1],e,f,p),c(d[x+1],n,f,g-1)),b(q,c(d[v+1],e,o,p),c(d[y+1],n,o,p))))}}},scene,camera,renderer,windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,mouseX=0,mouseY=0,worldWidth=256,worldDepth=256,loader,geometry,material,mesh,torus;init(),document.addEventListener("mousemove",onDocumentMouseMove,!1),document.addEventListener("click",onDocumentClick,!1),window.addEventListener("resize",onWindowResize,!1);